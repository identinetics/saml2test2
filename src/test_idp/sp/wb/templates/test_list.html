{% extends "base.html" %}
{% import "test_status.html" as test_status %}
{% import "test_description.html" as test_description %}
{% import "test_result.html" as test_result %}

{% block content %}

<div id="instructions" class="jumbotron">
    <p>This service can test a SAML Identity Providers (IdP) entity category compliance.</p>

    <p>
        To get started <a href="/upload_metadata">upload the metadata</a> of the IdP.
        Then start testing by following the instructions below.
    </p>

    <p>An overview of test results from previously tested IdP's is available <a href="/results_overview">here</a>
    </p>

    <div class="panel panel-default">
        <div class="panel-heading" id="heading_instructions">
            <a class="accordion-toggle collapsed" data-toggle="collapse"
               href="#collapse_instructions" aria-expanded="false" aria-controls="collapse_instructions"
               role="button">
                <h4 class="no-margin">
                    Instructions
                </h4>
            </a>
        </div>
        <div id="collapse_instructions" class="panel-collapse collapse" aria-labelledby="heading_instructions">
            <div class="panel-body">
                <div class="row">
                    <div class="col-md-6">
                        <p>
                            To start a test click on the run test button on the row of the test you
                            would like to run. If you want to start all tests click on the Run all
                            test button above the test list. You will be prompted to choose which
                            IdP to use before the test begins.
                        </p>

                        <p>
                            If you want more information about a test or the response generated by a
                            test click anywhere on the row of the test.
                        </p>
                    </div>
                    <div class="col-md-6">
                        <span class="h3">Possible test status</span>
                        {{ test_status.render() }}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<h2>Available tests</h2>

<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
    {% for test_id, test_info in tests|dictsort %}
        {% if test_id in test_results %}
            {% set status_css_class = test_status.css_class(test_results[test_id].status.value) %}
            {% set status_text = test_results[test_id].status.short_text %}
        {% else %}
            {% set status_css_class, status_text =  ('status-not-run', 'Not run') %}
        {% endif %}


        <div class="panel panel-default">
             <div class="{{ status_css_class }} border-below">
                <div class="panel-heading" role="tab" id="heading_{{test_id}}">
                    <div class="row">
                        <!--Make sure the columns of the row only adds upp to 11 to leave room for icon showing collapsed/expandend (from class .accordion-toggle:before) -->
                        <a class="accordion-toggle collapsed" data-toggle="collapse" role="button" data-parent="#accordion" href="#collapse_{{test_id}}" aria-controls="collapse_{{test_id}}" aria-expanded="false">
                            <h3 class="col-md-6 no-margin">
                                {{ test_info.short_name }}
                            </h3>
                        </a>
                        <div class="col-md-3">Status: {{ status_text }}</div>
                        <div class="col-md-2">
                            <button type="button" class="btn btn-sm btn-primary pull-right"
                                    onclick="runTest('{{ test_id }}');">Run test
                            </button>
                        </div>
                    </div>
                </div>
             </div>

            <div id="collapse_{{test_id}}" class="panel-collapse collapse collapsed" role="tabpanel"
                 aria-labelledby="heading_{{test_id}}">
                <div class="panel-body">
                    <div class="row border-between">
                        <div class="col-md-6">
                            <h4>Test result</h4>
                            {% if test_id in test_results %}
                                {{ test_result.render(test_results[test_id]) }}
                            {% else %}
                                No result exists.
                            {% endif %}
                        </div>

                        <div class="col-md-6">
                            {{ test_description.render(test_info) }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endfor %}
</div>

{% endblock %}